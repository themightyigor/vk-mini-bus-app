(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{241:function(e,t,a){e.exports=a.p+"static/media/logo.277c5867.svg"},247:function(e,t,a){e.exports=a.p+"static/media/persik.7a7c06ad.png"},255:function(e,t,a){e.exports=a(570)},373:function(e,t,a){},570:function(e,t,a){"use strict";a.r(t);a(256),a(281);var n=a(0),r=a.n(n),l=a(57),c=a.n(l),o=a(95),i=a.n(o),s=a(133),u=a.n(s),m=a(240),d=a(29),p=a(4),E=(a(355),a(96)),f=a.n(E),v=a(241),g=a.n(v),h=a(97),y=a(242),b=a.n(y),_=function(e){var t=e.from,a=e.to,n=e.router,l=e.onSubmit,c=e.swapValues;return r.a.createElement(p.FormLayout,{onSubmit:l},r.a.createElement(p.FormLayoutGroup,null,r.a.createElement(p.SelectMimicry,{name:"from",top:"\u041a\u0443\u0434\u0430",onClick:function(){return n.navigate("select",{state:"from"})}},t.city),r.a.createElement("div",{style:{display:"flex",justifyContent:"center"}},r.a.createElement(b.a,{fill:"var(--accent)",onClick:c})),r.a.createElement(p.SelectMimicry,{name:"to",top:"\u041e\u0442\u043a\u0443\u0434\u0430",onClick:function(){return n.navigate("select",{state:"to"})}},a.city)),r.a.createElement(p.Button,{size:"xl",level:"primary"},"\u041d\u0430\u0439\u0442\u0438"))},C=a(65),w=a.n(C),T=[{name:"\u041a\u0438\u043d\u0433\u0438\u0441\u0435\u043f\u043f",code:"c10870"},{name:"\u0421\u0430\u043d\u043a\u0442-\u041f\u0435\u0442\u0435\u0440\u0431\u0443\u0440\u0433",code:"c2"}],S=function(e){var t=e.route,a="from"===t.params.state?e.from:e.to;return r.a.createElement("div",null,r.a.createElement(p.PanelHeader,null,"from"===t.name?"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043c\u0435\u0441\u0442\u043e \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u044f":"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043c\u0435\u0441\u0442\u043e \u043d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f"),r.a.createElement(p.Group,null,r.a.createElement(p.List,null,T.map(function(n){return function(n,l){return r.a.createElement(p.Cell,{key:l,onClick:function(){e.handleCitySelect(t.params.state,n,l)},asideContent:a===n?r.a.createElement(w.a,{fill:"var(--accent)"}):null},n)}(n.name,n.code)}))))},x=a(243),k=a(254),O=function(e,t){switch(t.type){case"FETCH_DATA_SUCCESS":var a=function(e){var t=/[\u2014,-]/,a=function(e){return e.split(t)[0].trim()},n=a(e.search.from.title);return e.segments.map(function(e){var t=a(e.thread.title)!==n;return Object(k.a)({},e,{isTransit:t})})}(t.payload);return e.departures=a,e.sortedDepartures=a,e.loading=!1,void(e.error=!1);case"FETCH_DATA_REQUEST":return void(e.loading=!0);case"FETCH_DATA_ERROR":return e.error=!0,void(e.loading=!1);case"SET_FILTER":var n=t.payload;if(n===e.mode)return;e.mode=n;var r=e.departures;if("all"!==n){var l=new Date,c=l.toDateString();r=r.filter(function(e){return Date.parse("".concat(c," ").concat(e.departure))>l})}return void(e.sortedDepartures=r);case"TOGGLE_TOOLTIP":return void(e.tooltip=!1);default:return}},j=r.a.createContext(),D=function(e){var t=Object(x.a)(O,{departures:[],sortedDepartures:[],loading:!1,error:!1,mode:"all",tooltip:!0}),a=Object(d.a)(t,2),n=a[0],l=a[1];return r.a.createElement(j.Provider,{value:{state:n,dispatch:l}},e.children)},P=a(98),F=a.n(P),R=(a(373),function(e){var t=e.stops;return r.a.createElement(r.a.Fragment,null,r.a.createElement(p.List,null,r.a.createElement(p.Cell,null,r.a.createElement("div",{className:"stop_table__item"},r.a.createElement("div",{className:"stop_table__item__title stop_table__header"},"\u041e\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430"),r.a.createElement("div",{className:"stop_table__item__departure stop_table__header"},"\u041e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435"))),t.map(function(e,t){return r.a.createElement(p.Cell,{key:t,multiline:!0},r.a.createElement("div",{className:"stop_table__item"},r.a.createElement("div",{className:"stop_table__item__title"},e.station.title),r.a.createElement("div",{className:"stop_table__item__departure"},e.departure?e.departure.slice(10,-3):e.arrival.slice(10,-3))))})))}),A=a(571),L=A.compose,G=A.withProps,H=A.lifecycle,V=a(375),I=V.withScriptjs,M=V.withGoogleMap,N=V.GoogleMap,U=V.DirectionsRenderer,B=L(G({googleMapURL:"https://maps.googleapis.com/maps/api/js?key=AIzaSyBc3bsKQXVsZ-P-MRqPQyIiW1xwi_HEGZw&v=3.exp&libraries=geometry,drawing,places",loadingElement:r.a.createElement("div",{style:{height:"100%"}}),containerElement:r.a.createElement("div",{style:{height:"400px"}}),mapElement:r.a.createElement("div",{style:{height:"100%"}})}),I,M,H({componentDidMount:function(){var e=this,t=new window.google.maps.DirectionsService,a=this.props.stops.map(function(e){return e.station.title});t.route({origin:a[0],waypoints:a.slice(1,a.length-1).map(function(e){return{location:e,stopover:!0}}),destination:a[a.length-1],travelMode:window.google.maps.TravelMode.DRIVING},function(t,a){a===window.google.maps.DirectionsStatus.OK?e.setState({directions:t}):console.error("error fetching directions ".concat(t))})}}))(function(e){return r.a.createElement("div",null,r.a.createElement(N,{defaultZoom:8,defaultCenter:new window.google.maps.LatLng(59.3628097,28.5400579)},e.directions&&r.a.createElement(U,{directions:e.directions})))}),Q=a(245),z=a.n(Q),K=a(246),W=a.n(K),Z={details:{},loading:!0},q=function(e){var t=e.router,a=e.route,l=Object(n.useState)(Z),c=Object(d.a)(l,2),o=c[0],i=c[1];return Object(n.useEffect)(function(){f.a.get("https://cors-anywhere.herokuapp.com/https://api.rasp.yandex.net/v3.0/thread/?apikey=".concat("365aff1e-08cb-4bd2-bfa3-16a2eb089e0e","&format=json&uid=").concat(a.params.uid,"&lang=ru_RU&show_systems=all\n      ")).then(function(e){i(e.data)}).catch(function(e){return console.log(e)})},[]),r.a.createElement(r.a.Fragment,null,r.a.createElement(p.PanelHeader,{left:r.a.createElement(F.a,{onClick:function(){return t.navigate("departures")}})},"\u0414\u0435\u0442\u0430\u043b\u0438"),o.loading?r.a.createElement("div",{style:{display:"flex",alignItems:"center",flexDirection:"column"}},r.a.createElement(p.Spinner,{size:"small",style:{marginTop:"20px"}})):r.a.createElement(r.a.Fragment,null,r.a.createElement(p.Group,{title:"\u0418\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f"},r.a.createElement(p.List,null,r.a.createElement(p.Cell,{multiline:!0,before:r.a.createElement(z.a,null)},"".concat(o.title," ").concat(o.number&&"\u2116".concat(o.number))),r.a.createElement(p.Cell,{before:r.a.createElement(W.a,null)},o.days))),r.a.createElement(p.Group,{title:"\u041c\u0430\u0440\u0448\u0440\u0443\u0442 \u0441\u043b\u0435\u0434\u043e\u0432\u0430\u043d\u0438\u044f"},r.a.createElement(R,{stops:o.stops})),r.a.createElement(p.Footer,null,"\u0427\u0430\u0441\u0442\u043e \u0430\u0432\u0442\u043e\u0431\u0443\u0441\u044b \u043e\u043f\u0430\u0437\u0434\u044b\u0432\u0430\u044e\u0442 \u0438\u043b\u0438 \u043f\u0440\u0438\u0445\u043e\u0434\u044f\u0442 \u0440\u0430\u043d\u044c\u0448\u0435. \u041e\u0431\u044b\u0447\u043d\u043e \u0441\u0442\u043e\u044f\u043d\u043a\u0430 \u0442\u0440\u0430\u043d\u0437\u0438\u0442\u043d\u043e\u0433\u043e \u0430\u0432\u0442\u043e\u0431\u0443\u0441\u0430 \u2014 2\u20135 \u043c\u0438\u043d\u0443\u0442\u044b."),r.a.createElement(p.Group,{title:"\u041f\u0440\u0438\u043c\u0435\u0440\u043d\u044b\u0439 \u043c\u0430\u0440\u0448\u0440\u0443\u0442"},r.a.createElement(B,{stops:o.stops}))))},J=a(247),X=a.n(J),Y=function(e){var t=e.router,a=Object(n.useContext)(j),l=a.dispatch,c=a.state,o=c.sortedDepartures,i=c.mode,s=c.error,u=c.tooltip,m=function(e,a){return r.a.createElement(p.Cell,{onClick:function(){return t.navigate("details",{uid:a})},description:e.isTransit?"\u0442\u0440\u0430\u043d\u0437\u0438\u0442\u043d\u044b\u0439":null,expandable:!0,key:a},e.slice(0,-3))};return"hide"===i&&!o.length||s?r.a.createElement(r.a.Fragment,null,r.a.createElement("img",{className:"Persik",style:{display:"block",width:"50%",maxWidth:"240px",margin:"20px auto"},src:X.a,alt:"Persik The Cat"}),r.a.createElement(p.Footer,null,s?"\u041e\u0448\u0438\u0431\u043a\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430":"\u041a \u0441\u043e\u0436\u0430\u043b\u0435\u043d\u0438\u044e, \u0432\u0441\u0435 \u0440\u0435\u0439\u0441\u044b \u0443\u0436\u0435 \u0443\u0448\u043b\u0438")):r.a.createElement(r.a.Fragment,null," ",r.a.createElement(p.Group,{title:"\u0412\u0440\u0435\u043c\u044f \u0438 \u0434\u043d\u0438 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u044f"},r.a.createElement(p.List,null,o.map(function(e,t){return 0===t?r.a.createElement(p.Tooltip,{key:t,text:"\u0414\u043b\u044f \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0430 \u0434\u0435\u0442\u0430\u043b\u0435\u0439 \u043d\u0430\u0436\u043c\u0438\u0442\u0435 \u043d\u0430 \u044f\u0447\u0435\u0439\u043a\u0443 \u0441\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0435\u043c",isShown:u,onClose:function(){return l({type:"TOGGLE_TOOLTIP"})},offsetX:10},m(e.departure,e.thread.uid)):m(e.departure,e.thread.uid)}))),r.a.createElement(p.Footer,null,"\u041d\u0430\u0439\u0434\u0435\u043d\u043e \u0440\u0435\u0439\u0441\u043e\u0432: ",o.length))},$=a(248),ee=a.n($),te=a(249),ae=a.n(te),ne=a(250),re=a.n(ne),le=r.a.memo(function(e){var t=e.router,a=Object(n.useState)(!1),l=Object(d.a)(a,2),c=l[0],o=l[1],i=Object(n.useContext)(j),s=i.dispatch,u=i.state.mode,m=function(e){var t=e.currentTarget.dataset.mode;s({type:"SET_FILTER",payload:t}),requestAnimationFrame(function(){return o(!1)})};return r.a.createElement(r.a.Fragment,null,r.a.createElement(p.PanelHeader,{left:r.a.createElement(F.a,{onClick:function(){return t.navigate("home")}})},r.a.createElement(p.PanelHeaderContent,{onClick:function(){return o(!c)},aside:r.a.createElement(ee.a,null)},"\u041e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435")),r.a.createElement(p.HeaderContext,{opened:c,onClose:function(){return o(!1)}},r.a.createElement(p.List,null,r.a.createElement(p.Cell,{before:r.a.createElement(re.a,{fill:"var(--accent)"}),asideContent:"all"===u?r.a.createElement(w.a,{fill:"var(--accent)"}):null,onClick:m,"data-mode":"all"},"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0432\u0441\u0435"),r.a.createElement(p.Cell,{before:r.a.createElement(ae.a,{fill:"var(--accent)"}),asideContent:"hide"===u?r.a.createElement(w.a,{fill:"var(--accent)"}):null,onClick:m,"data-mode":"hide"},"\u0421\u043a\u0440\u044b\u0442\u044c \u0443\u0448\u0435\u0434\u0448\u0438\u0435"))))}),ce=a(251),oe=a.n(ce),ie=function(){return r.a.createElement(p.Div,{className:"footer",style:{display:"flex",justifyContent:"center",textAlign:"center"}},r.a.createElement(p.Button,{level:"3",component:"a",target:"_blank",href:"http://rasp.yandex.ru/",before:r.a.createElement(oe.a,null)},"\u0414\u0430\u043d\u043d\u044b\u0435 \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u044b \u0441\u0435\u0440\u0432\u0438\u0441\u043e\u043c \u042f\u043d\u0434\u0435\u043a\u0441.\u0420\u0430\u0441\u043f\u0438\u0441\u0430\u043d\u0438\u044f"))},se=function(){var e=Object(h.b)(""),t=e.route,a=e.router,l=Object(n.useContext)(j),c=l.state.loading,o=l.dispatch,i=Object(n.useState)({code:"c10870",city:"\u041a\u0438\u043d\u0433\u0438\u0441\u0435\u043f\u043f"}),s=Object(d.a)(i,2),E=s[0],v=s[1],y=Object(n.useState)({code:"c2",city:"\u0421\u0430\u043d\u043a\u0442-\u041f\u0435\u0442\u0435\u0440\u0431\u0443\u0440\u0433"}),b=Object(d.a)(y,2),C=b[0],w=b[1],T=function(){var e=Object(m.a)(u.a.mark(function e(t,n){var r;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o({type:"FETCH_DATA_REQUEST"}),e.prev=1,e.next=4,f()("https://cors-anywhere.herokuapp.com/https://api.rasp.yandex.net/v3.0/search/?apikey=".concat("365aff1e-08cb-4bd2-bfa3-16a2eb089e0e","&\nformat=json&from=").concat(t,"&to=").concat(n,"&lang=ru_RU&page=1&transport_types=bus"));case 4:r=e.sent,o({type:"FETCH_DATA_SUCCESS",payload:r.data}),a.navigate("departures"),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),o({type:"FETCH_DATA_ERROR"});case 12:case"end":return e.stop()}},e,null,[[1,9]])}));return function(t,a){return e.apply(this,arguments)}}(),x="select"===t.name?"selectView":"homeView",k=t.name;return r.a.createElement(p.Root,{popout:c?r.a.createElement(p.ScreenSpinner,null):null,activeView:x},r.a.createElement(p.View,{activePanel:k,id:"homeView"},r.a.createElement(p.Panel,{id:"home"},r.a.createElement(p.PanelHeader,null,"\u0420\u0430\u0441\u043f\u0438\u0441\u0430\u043d\u0438\u0435 841"),r.a.createElement(p.Div,{style:{textAlign:"center",marginTop:10}},r.a.createElement("img",{width:96,height:96,src:g.a,alt:"logo"})),r.a.createElement(_,{onSubmit:function(e){e.preventDefault(),E.code!==C.code&&T(E.code,C.code)},from:E,to:C,swapValues:function(){v(C),w(E)},router:a}),r.a.createElement(ie,null)),r.a.createElement(p.Panel,{id:"departures"},r.a.createElement(le,{router:a}),r.a.createElement(Y,{route:t,router:a})),r.a.createElement(p.Panel,{id:"details"},r.a.createElement(q,{route:t,router:a}))),r.a.createElement(p.View,{activePanel:k,id:"selectView"},r.a.createElement(p.Panel,{id:"select"},r.a.createElement(S,{handleCitySelect:function(e,t,n){"from"===e?v({code:n,city:t}):w({code:n,city:t}),a.navigate("home")},route:t,from:E.city,to:C.city}))))},ue=a(66),me=a(252),de=a(253),pe=[{name:"home",path:"/"},{name:"select",path:"/select"},{name:"departures",path:"/departures"},{name:"details",path:"/departures/:uid"}];i.a.send("VKWebAppInit",{});var Ee=function(){var e=Object(ue.b)(pe,{defaultRoute:"schedules"});return e.usePlugin(me.a),e.usePlugin(Object(de.a)({useHash:!0})),e}();Ee.start(function(){c.a.render(r.a.createElement(D,null,r.a.createElement(h.a,{router:Ee},r.a.createElement(se,{router:Ee}))),document.getElementById("root"))})}},[[255,1,2]]]);
//# sourceMappingURL=main.e5cc0974.chunk.js.map